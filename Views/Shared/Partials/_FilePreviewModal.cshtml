<div class="modal fade" id="filePreviewModal" tabindex="-1" aria-labelledby="filePreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filePreviewModalLabel">File Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center" id="filePreviewContent">
                <p>Loading...</p>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const previewModal = document.getElementById('filePreviewModal');
        const previewContent = document.getElementById('filePreviewContent');

        previewModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const fileUrl = button.getAttribute('data-url');
            const fileType = button.getAttribute('data-type'); // optional (pdf, image, excel, etc.)

            if (!fileUrl) return;

            let contentHtml = "<p>Preview not available.</p>";

            // If you have explicit type in the button
            if (fileType) {
                if (fileType === "pdf") {
                    contentHtml = `<iframe src="${fileUrl}" width="100%" height="600px" style="border:none;"></iframe>`;
                } else if (fileType === "image") {
                    contentHtml = `<img src="${fileUrl}" style="max-width:100%; max-height:600px;" alt="Preview" />`;
                } else if (fileType === "excel") {
                    // Excel can't render inline, just show download link
                    contentHtml = `
                        <p class="mb-2">Excel preview is not supported.
                        <a href="${fileUrl}" target="_blank" class="btn btn-sm btn-primary">Download</a></p>`;
                } else {
                    contentHtml = `<p>Unsupported file type.</p>`;
                }
            } else {
                // fallback: check extension from url
                if (fileUrl.endsWith(".pdf")) {
                    contentHtml = `<iframe src="${fileUrl}" width="100%" height="600px" style="border:none;"></iframe>`;
                } else if (/\.(png|jpg|jpeg)$/i.test(fileUrl)) {
                    contentHtml = `<img src="${fileUrl}" style="max-width:100%; max-height:600px;" alt="Preview" />`;
                } else if (/\.(xls|xlsx)$/i.test(fileUrl)) {
                    contentHtml = `
                        <p class="mb-2">Excel preview is not supported.
                        <a href="${fileUrl}" target="_blank" class="btn btn-sm btn-primary">Download</a></p>`;
                }
            }

            previewContent.innerHTML = contentHtml;
        });

        previewModal.addEventListener('hidden.bs.modal', function () {
            previewContent.innerHTML = "<p>Loading...</p>";
        });
    });
</script>

