@model LittleArkFoundation.Areas.Admin.Models.GeneralAdmission.GeneralAdmissionViewModel
@{
    // Unique MSWs
    var msws = Model.Users.Select(u => u.Username).Distinct().ToList();

    // Group discharges by ProcessedDate
    var grouped = Model.GeneralAdmissions
        .GroupBy(d => d.Date)
        .OrderBy(g => g.Key)
        .ToList();
    var mswTotals = msws.ToDictionary(msw => msw, msw => Model.GeneralAdmissions.Count(d => d.MSW == msw));
    var overallTotal = Model.GeneralAdmissions.Count;
}

<h5 style="margin-top: 15px;">COUNTA of Date Processed by MSW</h5>
<div class="container-fluid px-0 mx-0" style="max-width: 1600px;">
    <div class="table-responsive" style="overflow-x: auto;">
        <table class="table" style="min-width: 1200px;">
            <thead>
                @if (Model != null)
                {
                    <tr>
                        <th>Date Processed</th>
                        @foreach (var msw in msws)
                        {
                            <th>@msw</th>
                        }
                        <th>Grand Total</th>
                    </tr>
                }
            </thead>
            <tbody>
                @if (Model != null)
                {
                    @foreach (var group in grouped)
                    {
                        <tr>
                            <td>@group.Key.ToShortDateString()</td>

                            @foreach (var msw in msws)
                            {
                                var count = group.Count(d => d.MSW == msw);
                                <td>@count</td>
                            }

                            <td>@group.Count()</td>
                        </tr>
                    }

                    <tr class="fw-bold">
                        <td>Total</td>
                        @foreach (var msw in msws)
                        {
                            <td>@mswTotals[msw]</td>
                        }
                        <td>@overallTotal</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
